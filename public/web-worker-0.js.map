{"version":3,"file":"index.js","sources":["src/worker/Requests.js","src/worker/index.js"],"sourcesContent":["//ddddddd\n\n//http://maps.kosmosnimki.ru/TileSender.ashx?skipTiles=All&MapName=C8612B3A77D84F3F87953BEF17026A5F&srs=3857&ftc=osm&ModeKey=map\n\n// http://maps.kosmosnimki.ru/TileSender.ashx?WrapStyle=func&skipTiles=All&MapName=C8612B3A77D84F3F87953BEF17026A5F&srs=3857&ftc=osm&ModeKey=map&key=&CallbackName=_1\n\n\n\nconst\t_self = self,\n\t\tserverBase = _self.serverBase || 'http://maps.kosmosnimki.ru/',\n\t\tserverProxy = serverBase + 'Plugins/ForestReport/proxy';\n\nlet loaderStatus = {};\nconst getMapTree = (params) => {\n\tparams = params || {};\n\t\n\tlet url = `${serverBase}Map/GetMapFolder`;\n\turl += '?mapId=' + (params.mapId || 'C8612B3A77D84F3F87953BEF17026A5F');\n\turl += '&folderId=root';\n\turl += '&srs=3857';\n\turl += '&skipTiles=All';\n\n\tloaderStatus[url] = true;\n\n\treturn fetch(url, {\n\t\tmethod: 'get',\n\t\tmode: 'cors',\n\t\tcredentials: 'include',\n\t\t// headers: {'Accept': 'application/json'},\n\t\t// body: JSON.stringify(params)\t// TODO: сервер почему то не хочет работать так https://googlechrome.github.io/samples/fetch-api/fetch-post.html\n\t})\n\t\t.then(res => {\n\t\t\tdelete loaderStatus[url];\n\t\t\treturn res.json();\n\t\t})\n\t\t.then(json => {\n\t\t\treturn parseTree(json);\n\t\t})\n\t\t.catch(err => console.warn(err));\n};\n\nconst _iterateNodeChilds = (node, level, out) => {\n\tlevel = level || 0;\n\tout = out || {\n\t\tlayers: []\n\t};\n\t\n\tif (node) {\n\t\tlet type = node.type,\n\t\t\tcontent = node.content,\n\t\t\tprops = content.properties;\n\t\tif (type === 'layer') {\n\t\t\tlet ph = { level: level, properties: props };\n\t\t\tif (content.geometry) { ph.geometry = content.geometry; }\n\t\t\tout.layers.push(ph);\n\t\t} else if (type === 'group') {\n\t\t\t(content.children || []).map((it) => {\n\t\t\t\t_iterateNodeChilds(it, level + 1, out);\n\t\t\t});\n\t\t}\n\t\t\n\t} else {\n\t\treturn out;\n\t}\n\treturn out;\n};\n\nconst parseTree = (json) => {\n\tlet out = {};\n\tif (json.Status === 'error') {\n\t\tout = json;\n\t} else if (json.Result && json.Result.content) {\n\t\tout = _iterateNodeChilds(json.Result);\n\t}\n console.log('______json_out_______', out, json)\n\treturn out;\n};\nexport default {\n\tgetMapTree\n};","import Requests from './Requests.js';\n\nvar _self = self;\n(_self.on || _self.addEventListener).call(_self, 'message', e => {\n    const message = e.data || e;\n\tif (message.cmd === 'getMap') {\n\t\tRequests.getMapTree({mapId: message.mapID}).then((json) => {\n// console.log(message, json);\n\t\t\tmessage.out = json;\n\t\t\t_self.postMessage(message);\n\t\t});\n\t}\n\t\n/*\n    switch (message.type) {\n        case 'init':\n            if (message.wasm) {\n                const memorySize = 16;\n                memory = new WebAssembly.Memory({initial: memorySize, maximum: memorySize});\n                view = new DataView(memory.buffer);\n                wasm = new WebAssembly.Instance(message.wasm, {\n                    env: {\n                        _now: _performance.now.bind(_performance),\n                        memory: memory,\n                    },\n                });\n                runWorkload = runWorkloadWASM;\n            } else {\n                runWorkload = runWorkloadJS;\n            }\n            runWorkload(1, 0);\n            _self.postMessage('success');\n            break;\n\n        case 'workload': {\n            setTimeout(() => {\n                _self.postMessage(runWorkload(10, message.id));\n            }, message.startTime - Date.now());\n            break;\n        }\n\n        default:\n            break;\n    }\n\t*/\n});\n\n"],"names":["_self"],"mappings":"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"}